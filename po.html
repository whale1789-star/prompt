<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­ç´šæ¦®è­½æ¦œ - å­¸ç”ŸæŸ¥è©¢</title>
    <style>
        :root { --gold: #FFD700; --silver: #C0C0C0; --bronze: #CD7F32; --primary: #6200ee; }
        body { font-family: -apple-system, sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 500px; margin: auto; }
        
        /* ç­ç´šé¸æ“‡å€ */
        .search-box { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 20px; text-align: center; }
        input { width: 80%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; margin-bottom: 10px; }
        button { padding: 10px 20px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; }

        /* æ’è¡Œæ¦œæ¨£å¼ */
        .rank-item { 
            display: flex; align-items: center; background: white; 
            margin-bottom: 10px; padding: 15px; border-radius: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: 0.3s;
        }
        .rank-num { width: 40px; font-size: 1.5em; font-weight: bold; color: #888; }
        .rank-1 { color: var(--gold); transform: scale(1.1); border: 2px solid var(--gold); }
        .rank-2 { color: var(--silver); }
        .rank-3 { color: var(--bronze); }
        
        .student-info { flex: 1; margin-left: 10px; }
        .student-name { font-size: 1.2em; font-weight: bold; }
        .score-val { font-size: 1.5em; font-weight: bold; color: var(--primary); }

        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div id="enterClass" class="search-box">
        <h2>ğŸ† é€²å…¥ç­ç´šæ¦®è­½æ¦œ</h2>
        <input type="text" id="classIdInput" placeholder="è«‹è¼¸å…¥ç­ç´šä»£ç¢¼ (å¦‚: 101)">
        <br>
        <button onclick="viewRank()">æŸ¥çœ‹æ’å</button>
    </div>

    <div id="rankSection" class="hidden">
        <h2 id="classNameTitle" style="text-align: center; color: #333;"></h2>
        <div id="rankList"></div>
        <button onclick="location.reload()" style="width: 100%; margin-top: 20px; background: #888;">è¿”å›æœå°‹</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

   
    const firebaseConfig = {
        apiKey: "AIzaSyCTUNT7oU2kNhqaF1qSuXjpQVrGJL3BXsc",
        authDomain: "score-a4e5b.firebaseapp.com",
        projectId: "score-a4e5b",
        storageBucket: "score-a4e5b.firebasestorage.app",
        messagingSenderId: "158303926526",
        appId: "1:158303926526:web:2485978b314a5536210daf"

    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.viewRank = () => {
        const classId = document.getElementById('classIdInput').value.trim();
        if (!classId) return alert("è«‹è¼¸å…¥ç­ç´šä»£ç¢¼");

        document.getElementById('enterClass').classList.add('hidden');
        document.getElementById('rankSection').classList.remove('hidden');
        document.getElementById('classNameTitle').innerText = `âœ¨ ${classId} æ¦®è­½æ¦œ âœ¨`;

        // ç›£è½è©²ç­ç´šï¼Œä¸¦æŒ‰åˆ†æ•¸ç”±é«˜åˆ°ä½æ’åº
        const q = query(collection(db, "classes", classId, "students"), orderBy("totalScore", "desc"));
        
        onSnapshot(q, (snapshot) => {
            const listDiv = document.getElementById('rankList');
            listDiv.innerHTML = "";
            let rank = 1;

            snapshot.forEach((doc) => {
                const data = doc.data();
                const item = document.createElement('div');
                item.className = `rank-item ${rank <= 3 ? 'rank-'+rank : ''}`;
                
                // ç‰¹æ®Šåœ–ç¤ºï¼šå‰ä¸‰åé¡¯ç¤ºçç‰Œ
                let rankDisplay = rank;
                if(rank === 1) rankDisplay = "ğŸ¥‡";
                if(rank === 2) rankDisplay = "ğŸ¥ˆ";
                if(rank === 3) rankDisplay = "ğŸ¥‰";

                item.innerHTML = `
                    <div class="rank-num">${rankDisplay}</div>
                    <div class="student-info">
                        <span class="student-name">${data.name}</span>
                    </div>
                    <div class="score-val">${data.totalScore}</div>
                `;
                listDiv.appendChild(item);
                rank++;
            });

            if (snapshot.empty) {
                listDiv.innerHTML = "<p style='text-align:center;'>æ‰¾ä¸åˆ°è©²ç­ç´šè³‡æ–™ï¼Œè«‹ç¢ºèªä»£ç¢¼æ˜¯å¦æ­£ç¢ºã€‚</p>";
            }
        });
    };
</script>
</body>
</html>
